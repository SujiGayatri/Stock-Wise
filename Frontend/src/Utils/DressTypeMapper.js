// src/Utils/DressTypeMapper.js

export const dressTypes = [
  'Kurti', 'T-Shirt', 'Jumpsuit', 'Skirt', 'Palazzo', 'Anarkali', 'Frocks',
  'Saree', 'Lehanga', 'Jean', 'WesternTop', 'Leggin', 'CropTop'
];

// Keywords mapped to your categories
export const dressTypeMappingsMen = {
  Shirt: [
    'shirt', 'dress shirt', 'button-down', 'formal shirt', 'long-sleeve shirt', 'tuxedo shirt',
    'jersey', 'blazer', 'sweatshirt', 'bulletproof vest', 'T-shirt', 'tee', 'tee shirt', 'jersey',
    'bearskin', 'busby', 'shako', 'cloak', 'velvet', 'trench coat', 'hoopskirt', 'smock'
  ],
  TShirt: [
    't-shirt', 'tee', 'jersey', 'crew neck', 'polo shirt', 'v-neck', 'tank top', 'singlet',
    'undershirt', 'vest', 'waffle iron', 'pajama', 'pyjama', 'jammies', 'sweatshirt', 'crop top',
    'bulletproof vest', 'cloak', 'chain saw', 'jersey', 'neck brace', 'armor'
  ],
  Jean: [
    'jean', 'denim', 'denim pants', 'trousers', 'slacks', 'cargo pants', 'chinos', 'khakis',
    'espresso maker', 'thresher', 'thrasher', 'chainsaw', 'lotion', 'knee pad', 'pajama pants'
  ],
  Trousers: [
    'trouser', 'trousers', 'formal pants', 'slacks', 'chinos', 'suit pants', 'corduroy pants',
    'sweatpants', 'joggers', 'bearskin', 'footstall', 'leggings'
  ],
  Suit: [
    'suit', 'tuxedo', 'blazer', 'suit of clothes', 'tailcoat', 'formal suit', 'sports jacket',
    'vestment', 'velvet', 'trench coat', 'cloak', 'academic robe', 'academic gown', 'band uniform',
    'military uniform'
  ],
  Kurta: [
    'kurta', 'long shirt', 'tunic', 'kurti', 'robe', 'cloak', 'kaftan', 'ankle-length shirt',
    'abaya', 'sherwani', 'dashiki'
  ],
  Sherwani: [
    'sherwani', 'indo-western', 'coat suit', 'achkan', 'bandhgala', 'nehru jacket',
    'gown', 'ankle-length coat', 'robe', 'velvet coat', 'formal robe'
  ],
  Dhoti: [
    'dhoti', 'lungi', 'veshti', 'panche', 'wrap skirt', 'sarong', 'loincloth'
  ],
  Jacket: [
    'jacket', 'leather jacket', 'bomber', 'windbreaker', 'hoodie', 'blazer', 'coat',
    'trench coat', 'sweatshirt', 'anorak', 'parka', 'overcoat'
  ],
  Hoodie: [
    'hoodie', 'hooded sweatshirt', 'sweatshirt', 'jumper', 'pullover', 'anorak',
    'maillot', 'jersey', 'cloak'
  ],
  Shorts: [
    'shorts', 'cargo shorts', 'denim shorts', 'gym shorts', 'boxer', 'bermuda shorts',
    'cycling shorts', 'compression shorts'
  ],
  Lungis: [
    'lungi', 'sarong', 'wrap skirt', 'dhoti', 'panche', 'veshti', 'loincloth'
  ],
  Vest: [
    'vest', 'waistcoat', 'undershirt', 'tank top', 'singlet', 'innerwear',
    'bulletproof vest', 'armor', 'jersey'
  ]
};

export const dressTypeMappings = {
  Skirt: ['skirt', 'overskirt', 'mini skirt', 'long skirt','pleated skirt', 'wrap skirt'],
  Saree: ['sari', 'saree'],
  Jean: ['jean', 'denim',, 'denim pants','espresso maker','thresher', 'thrasher', 'threshing machine','affenpinscher', 'monkey pinscher', 'monkey','oil filter','spatula','lotion','knee pad','Windsor tie','hair spray','sweatshirt','spatula','chain saw', 'chainsaw'],
  TShirt: ['t-shirt', 'tee', 'jersey', 'tee shirt','waffle iron','chain saw','chainsaw',"bobsled", "bobsleigh", "bob",'pajama','pyjama','pjs','jammies','bearskin','busby','shako','punching bag', 'punch bag', 'punching ball'
    ,'parallel bars', 'bars','bulletproof vest','knee pad','punching bag', 'punch bag', 'punching ball','gong', 'tam-tam','pickelhaube','folding chair','croquet ball',
  ],
  Frock: ['frock', 'dress','apron','hoopskirt','crinoline', 'evening gown', 'sundress','trench coat','kimono','pajama','pyjama','pjs','jammies','fur coat'],
  Kurti: ['kurti', 'kurta', 'tunic'],
  Jumpsuit: ['jumpsuit', 'romper'],
  Palazzo: ['palazzo','hair spray' ,'parallel bars', 'bars','wide-leg pants','otterhound','chime','pedestal', 'plinth', 'footstall', 'bell', 'gong','matchstick', 'chime','switch', 'electric switch', 'bell', 'gong','otter hound', 'gown','sarong','cardigan','pajama','pyjama','pjs','jammies',"abaya","kimono",'trench coat','mini','suit','suit of clothes','can opener', 'tin opener','whistle','throne','velvet','academic gown', 'academic robe','nipple','folding chair','panpipe', 'pandean pipe', 'safety pin','Windsor tie','spatula','bassoon','knee pad','abaya','Windsor tie','maraca','wire-haired fox terrier','nematode', 'nematode worm', 'cleaver','bearskin', 'busby', 'tick','shako', 'meat cleaver', 'chopper','roundworm','Band Aid','syrinx','pedestal', 'plinth', 'footstall','vestment','throne','overskirt','oboe', 'hautboy', 'hautbois','power drill','chain saw', 'chainsaw','table lamp'],
  Leggin: ['legging', 'leggings', 'tights','bolo tie', 'bolo', 'bola tie', 'bola','panpipe', 'pandean pipe', 'syrinx','maraca','bassoon','gong', 'tam-tam','tripod','knee pad','bearskin', 'busby', 'shako','panpipe', 'pandean pipe', 'syrinx','redbone','muzzle','Ibizan hound', 'Ibizan Podenco','bulletproof vest','torch','maillot', 'tank suit','torch','ski','maillot', 'tank suit','bearskin', 'busby', 'shako'],
  Lehanga: ['lehenga', 'ghagra', 'chaniya choli'],
  WesternTop: ['blouse', 'shirt', 'tank top', 'halter top', 'top', 'peplum top', 'camisole',
    'button-down shirt', 'sleeveless shirt', 'crop blouse','overskirt','hoopskirt', 'crinoline','bulletproof vest'],
  CropTop: ['crop top', 'cropped', 'cropped shirt','tennis ball','maillot', 'tank suit','overskirt','chain saw', 'chainsaw','hoopskirt', 'crinoline','bulletproof vest',"plunger', 'plumber's helper",'sweatshirt','velvet','jersey', 'T-shirt', 'tee shirt','neck brace','thresher', 'thrasher', 'threshing machine','cloak'],
  Anarkali: ['anarkali','gown'],


  
};

const keywordToCategories = {};
for (const [category, keywords] of Object.entries(dressTypeMappings)) {
  for (const keyword of keywords) {
    if (typeof keyword !== 'string') continue;
    const key = keyword.toLowerCase();
    // console.log(key)
    keywordToCategories[key] = keywordToCategories[key] || [];
    keywordToCategories[key].push(category);
  }
}

// export const mapToDressType = (rawLabel) => {
//   const lower = rawLabel.toLowerCase();
//   console.warn(`Unknown label detected: "${rawLabel}"`);
//   for (const [category, keywords] of Object.entries(dressTypeMappings)) {
//     if (keywords.some(keyword => lower.includes(keyword))) {
//       return category;
//     }
//   }

//   console.warn(`Unknown label detected: "${rawLabel}"`);
//   return 'Unknown';
// };


/**
 * Confidence-based category resolver.
 * @param {Array} predictions - Array of { className: string, probability: number }
 * @returns {string} Most likely category
 */
// export const resolveDressCategory = (predictions) => {
//   const scores = {};

//   for (const pred of predictions) {
//     if (!pred?.className || typeof pred.className !== 'string') continue;

//     const lowerLabel = pred.className.toLowerCase();
//     const probability = pred.probability || 0;

//     for (const [keyword, categories] of Object.entries(keywordToCategories)) {
//       if (lowerLabel.includes(keyword)) {
//         for (const cat of categories) {
//           if (cat === 'Kurti') continue;
//           scores[cat] = (scores[cat] || 0) + probability;
//         }
//       }
//     }
//   }

//   const sorted = Object.entries(scores).sort((a, b) => b[1] - a[1]);
//   return sorted.length > 0 ? sorted[0][0] : 'Unknown';
// };

export const resolveDressCategory = (predictions) => {
  const scores = {};

  for (const pred of predictions) {
    if (!pred?.className || typeof pred.className !== 'string') continue;

    const lowerLabel = pred.className.toLowerCase();
    const probability = pred.probability || 0;

    for (const [keyword, categories] of Object.entries(keywordToCategories)) {
      if (lowerLabel.includes(keyword)) {
        for (const cat of categories) {
          scores[cat] = (scores[cat] || 0) + probability;
        }
      }
    }
  }

  const sorted = Object.entries(scores).sort((a, b) => b[1] - a[1]);

  if (sorted.length === 0) {
    console.warn("⚠️ No category matched. Defaulting to 'Unknown'");
    return 'Unknown';
  }

  const [topCategory, score] = sorted[0];

  // Optional: thresholding (e.g., confidence must be at least 0.2 total)
  if (score < 0.2) {
    console.warn(`⚠️ Low confidence (${score.toFixed(2)}). Consider fallback logic.`);
    return 'Unknown';
  }

  return topCategory;
};
